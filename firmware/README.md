# STM32F334K6 bitcrusher firmware

## Brief overview of the algorithm:

ADC1 reads the control signals for bit-depth and sample rate automatically at a sample rate set by timer 3.
The control parameters are saved in a global signal via the DMA controller.

The audio signal is read by ADC2, triggered by timer 6, at a variable sample rate set by the sample-rate control signal.

The digitized audio signal is then processed by the bit crusher algorithm and output via DAC1.

A simple bicolor LED indicator is attached to two GPIO pins and acts as a basic signal strength and clipping indicator.

---

## Prerequisites for building and flashing the project:
- [arm-none-eabi toolchain](https://developer.arm.com/tools-and-software/open-source-software/developer-tools/gnu-toolchain/gnu-rm/downloads)
- [GNU make](https://www.gnu.org/software/make/)
- [st-link utility](https://www.st.com/en/development-tools/stsw-link004.html)
- A physical st-link device. I use an old [Nucleo board](https://www.st.com/en/evaluation-tools/stm32-nucleo-boards.html).
- If you have a different preferred method of flashing STM32 chips (openocd, etc) then feel free to go wild.

### To build the project:
- `$ make`

### To flash an STM32f334 chip connected to an st-link programmer via the SWD header:
- `$ make write`

---

## Firmware directory organization:
- `third_party` contains the STM32 supplied CMSIS files, assembly startup routine, and linker script.
- `BSP` is a very basic "Board Support Package", this module initializes and modifies the various stm32 peripherals used by the system.
- `lib` contains user library files.
- `src` contains the main application files.
- `bin` is the destination for output files generated by the build process.
